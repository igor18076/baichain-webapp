# BaiChain - –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ BaiChain –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–æ–∫ –∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–î–µ–ø–ª–æ–π –Ω–∞ Linux —Å Docker](#–¥–µ–ø–ª–æ–π-–Ω–∞-linux-—Å-docker)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-ssl-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **.NET 10.0** - –æ—Å–Ω–æ–≤–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
- **ASP.NET Core MVC** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **MailKit** - –æ—Ç–ø—Ä–∞–≤–∫–∞ email —á–µ—Ä–µ–∑ SMTP
- **Polly** - –ø–æ–ª–∏—Ç–∏–∫–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- **Bootstrap 5** - CSS —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **jQuery** - JavaScript –±–∏–±–ª–∏–æ—Ç–µ–∫–∞

## üì¶ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
- .NET 10.0 SDK
- Visual Studio 2022 –∏–ª–∏ VS Code
- Git

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
- Linux —Å–µ—Ä–≤–µ—Ä (Ubuntu 20.04+ / Debian 11+)
- Docker –∏ Docker Compose
- Nginx (–¥–ª—è reverse proxy –∏ SSL)
- Domain name —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º DNS

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd WebApplication2Test
```

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
cd WebApplication2
dotnet restore
dotnet run
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:5151`

## üíª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ User Secrets –¥–ª—è SMTP:**

```bash
cd WebApplication2
dotnet user-secrets set "Smtp:Host" "smtp.example.com"
dotnet user-secrets set "Smtp:Port" "587"
dotnet user-secrets set "Smtp:UseStartTls" "true"
dotnet user-secrets set "Smtp:Username" "your-username"
dotnet user-secrets set "Smtp:Password" "your-password"
dotnet user-secrets set "Smtp:FromAddress" "order@baichein.ru"
dotnet user-secrets set "Smtp:FromDisplayName" "BaiChain –∫–æ–º–∞–Ω–¥–∞"
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Visual Studio: –ü–ö–ú –Ω–∞ –ø—Ä–æ–µ–∫—Ç ‚Üí Manage User Secrets

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**

```bash
dotnet run --environment Development
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
WebApplication2/
‚îú‚îÄ‚îÄ Controllers/          # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã MVC
‚îÇ   ‚îú‚îÄ‚îÄ HomeController.cs # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏ —Ñ–æ—Ä–º–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
‚îÇ   ‚îî‚îÄ‚îÄ ErrorController.cs # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îú‚îÄ‚îÄ Models/               # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ ContactFormViewModel.cs
‚îÇ   ‚îî‚îÄ‚îÄ ErrorViewModel.cs
‚îú‚îÄ‚îÄ Services/             # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ BackgroundEmailQueue.cs # –û—á–µ—Ä–µ–¥—å email
‚îÇ   ‚îú‚îÄ‚îÄ MailKitEmailSender.cs   # –û—Ç–ø—Ä–∞–≤–∫–∞ email
‚îÇ   ‚îú‚îÄ‚îÄ QueuedEmailSender.cs    # –§–æ–Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ SmtpOptions.cs          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP
‚îú‚îÄ‚îÄ Views/                # Razor –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ Home/
‚îÇ   ‚îú‚îÄ‚îÄ Error/
‚îÇ   ‚îî‚îÄ‚îÄ Shared/
‚îú‚îÄ‚îÄ wwwroot/             # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îú‚îÄ‚îÄ Program.cs           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ Dockerfile           # Docker –æ–±—Ä–∞–∑
‚îî‚îÄ‚îÄ appsettings.json     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `appsettings.json`:

```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "Smtp": {
    "Host": "",
    "Port": 587,
    "UseStartTls": true,
    "Username": "",
    "Password": "",
    "FromAddress": "order@baichein.ru",
    "FromDisplayName": "BaiChain –∫–æ–º–∞–Ω–¥–∞"
  }
}
```

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ü–∞—Ä–æ–ª–∏ –∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ù–ï –¥–æ–ª–∂–Ω—ã —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ `appsettings.json`!

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å –¥–≤–æ–π–Ω—ã–º –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ–º:

```bash
Smtp__Host=smtp.example.com
Smtp__Port=587
Smtp__Password=your-password
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. [SMTP_CONFIGURATION.md](WebApplication2/SMTP_CONFIGURATION.md)

## üê≥ –î–µ–ø–ª–æ–π –Ω–∞ Linux —Å Docker

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker –∏ Docker Compose –Ω–∞ Linux —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# Ubuntu/Debian
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DNS –∑–∞–ø–∏—Å–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞:
   - A –∑–∞–ø–∏—Å—å: `@` ‚Üí IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞
   - A –∑–∞–ø–∏—Å—å: `www` ‚Üí IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞:

```bash
mkdir -p /opt/baichain
cd /opt/baichain
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
- `WebApplication2/Dockerfile`
- `WebApplication2/WebApplication2.csproj`
- –í—Å—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `WebApplication2/` (–∫—Ä–æ–º–µ `bin/` –∏ `obj/`)

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ docker-compose.yml

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `docker-compose.yml` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```yaml
version: '3.8'

services:
  webapp:
    build:
      context: ./WebApplication2
      dockerfile: Dockerfile
    container_name: baichain-webapp
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:8080
      - Smtp__Host=${SMTP_HOST}
      - Smtp__Port=${SMTP_PORT:-587}
      - Smtp__UseStartTls=${SMTP_USE_STARTTLS:-true}
      - Smtp__Username=${SMTP_USERNAME}
      - Smtp__Password=${SMTP_PASSWORD}
      - Smtp__FromAddress=${SMTP_FROM_ADDRESS:-order@baichein.ru}
      - Smtp__FromDisplayName=${SMTP_FROM_DISPLAY_NAME:-BaiChain –∫–æ–º–∞–Ω–¥–∞}
    volumes:
      - ./logs:/app/logs
      - ./app_data:/app/App_Data
    networks:
      - baichain-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  baichain-network:
    driver: bridge
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ —Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:

```bash
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USE_STARTTLS=true
SMTP_USERNAME=your-username
SMTP_PASSWORD=your-password
SMTP_FROM_ADDRESS=order@baichein.ru
SMTP_FROM_DISPLAY_NAME=BaiChain –∫–æ–º–∞–Ω–¥–∞
```

‚ö†Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –î–æ–±–∞–≤—å—Ç–µ `.env` –≤ `.gitignore` –∏ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –µ–≥–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π!

### –®–∞–≥ 4: –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker-compose build

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f webapp

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps
```

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx –∫–∞–∫ Reverse Proxy

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Nginx:

```bash
sudo apt update
sudo apt install nginx
```

–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `/etc/nginx/sites-available/baichain`:

```nginx
server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com;

    # –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS (–ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSL)
    # return 301 https://$server_name$request_uri;

    # –í—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è HTTP (–¥–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSL)
    location / {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection keep-alive;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤ –¥–ª—è –±–æ–ª—å—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
}
```

–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```bash
sudo ln -s /etc/nginx/sites-available/baichain /etc/nginx/sites-enabled/
sudo nginx -t  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo systemctl reload nginx
```

### –®–∞–≥ 6: –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ

–°–æ–∑–¥–∞–π—Ç–µ systemd —Å–µ—Ä–≤–∏—Å `/etc/systemd/system/baichain.service`:

```ini
[Unit]
Description=BaiChain Web Application
Requires=docker.service
After=docker.service

[Service]
Type=oneshot
RemainAfterExit=yes
WorkingDirectory=/opt/baichain
ExecStart=/usr/local/bin/docker-compose up -d
ExecStop=/usr/local/bin/docker-compose down
TimeoutStartSec=0

[Install]
WantedBy=multi-user.target
```

–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Å–µ—Ä–≤–∏—Å:

```bash
sudo systemctl daemon-reload
sudo systemctl enable baichain
sudo systemctl start baichain
```

## üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 1: Let's Encrypt (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Certbot:**

```bash
sudo apt update
sudo apt install certbot python3-certbot-nginx
```

2. **–ü–æ–ª—É—á–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:**

```bash
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com
```

Certbot –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü–æ–ª—É—á–∏—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- –ù–∞—Å—Ç—Ä–æ–∏—Ç Nginx –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è HTTPS
- –ù–∞—Å—Ç—Ä–æ–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**

```bash
sudo certbot renew --dry-run
```

–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –∫–∞–∂–¥—ã–µ 90 –¥–Ω–µ–π.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä:**

```bash
sudo mkdir -p /etc/nginx/ssl
sudo cp your-certificate.crt /etc/nginx/ssl/
sudo cp your-private-key.key /etc/nginx/ssl/
sudo chmod 600 /etc/nginx/ssl/your-private-key.key
```

2. **–û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx:**

```nginx
server {
    listen 443 ssl http2;
    server_name yourdomain.com www.yourdomain.com;

    ssl_certificate /etc/nginx/ssl/your-certificate.crt;
    ssl_certificate_key /etc/nginx/ssl/your-private-key.key;

    # –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSL
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384';
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;

    # HSTS
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

    location / {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection keep-alive;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}

# –†–µ–¥–∏—Ä–µ–∫—Ç HTTP –Ω–∞ HTTPS
server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com;
    return 301 https://$server_name$request_uri;
}
```

3. **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Nginx:**

```bash
sudo nginx -t
sudo systemctl reload nginx
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é SSL:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
openssl s_client -connect yourdomain.com:443 -servername yourdomain.com

# –û–Ω–ª–∞–π–Ω –ø—Ä–æ–≤–µ—Ä–∫–∞
# https://www.ssllabs.com/ssltest/analyze.html?d=yourdomain.com
```

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **HomeController** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ —Ñ–æ—Ä–º—ã –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
2. **BackgroundEmailQueue** - –æ—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
3. **MailKitEmailSender** - –æ—Ç–ø—Ä–∞–≤–∫–∞ email —á–µ—Ä–µ–∑ SMTP —Å retry –ø–æ–ª–∏—Ç–∏–∫–æ–π
4. **QueuedEmailSender** - —Ñ–æ–Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏ email

### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–∫–∏

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –§–æ—Ä–º–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
    ‚Üì
HomeController.Index (POST)
    ‚Üì
–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    ‚Üì
–°–æ–∑–¥–∞–Ω–∏–µ MimeMessage
    ‚Üì
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å (BackgroundEmailQueue)
    ‚Üì
–í–æ–∑–≤—Ä–∞—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    ‚Üì
[–§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å]
QueuedEmailSender
    ‚Üì
MailKitEmailSender (—Å retry)
    ‚Üì
SMTP —Å–µ—Ä–≤–µ—Ä
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- –í—Å–µ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è ‚Üí `/Error/500`
- HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥—ã (404, 403 –∏ —Ç.–¥.) ‚Üí `/Error/{–∫–æ–¥}`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ ILogger
- –§–∞–π–ª–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –≤ `App_Data/contact.log`

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã

- ‚úÖ HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- ‚úÖ HSTS –∑–∞–≥–æ–ª–æ–≤–∫–∏
- ‚úÖ Anti-forgery —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Ñ–æ—Ä–º
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ (User Secrets / –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç XSS —á–µ—Ä–µ–∑ Razor
- ‚úÖ Content Security Policy (—á–µ—Ä–µ–∑ Nginx)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```bash
dotnet list package --outdated
dotnet add package <package-name> --version <latest>
```

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è SMTP**
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ `/App_Data/contact.log`** (—Å–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª:**
```bash
sudo ufw allow 22/tcp   # SSH
sudo ufw allow 80/tcp   # HTTP
sudo ufw allow 443/tcp  # HTTPS
sudo ufw enable
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### Health Check

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è:

```bash
curl http://localhost:8080/health
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —á–µ—Ä–µ–∑ ILogger
- **–§–∞–π–ª–æ–≤—ã–µ –ª–æ–≥–∏** –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –≤ `App_Data/contact.log`
- **Docker –ª–æ–≥–∏:**
```bash
docker-compose logs -f webapp
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (UptimeRobot, Pingdom)
- –ê–ª–µ—Ä—Ç—ã –Ω–∞ –æ—à–∏–±–∫–∏ (Sentry, Application Insights)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞ (Prometheus + Grafana)

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs webapp

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
docker-compose config

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑
docker-compose build --no-cache
docker-compose up -d
```

### –ü—Ä–æ–±–ª–µ–º–∞: Email –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP –≤ `.env`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
docker-compose logs webapp | grep -i smtp
```
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SMTP —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω:
```bash
telnet smtp.example.com 587
```

### –ü—Ä–æ–±–ª–µ–º–∞: 502 Bad Gateway

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω:
```bash
docker-compose ps
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Nginx:
```bash
sudo tail -f /var/log/nginx/error.log
```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª—É—à–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 8080:
```bash
docker-compose exec webapp netstat -tlnp
```

### –ü—Ä–æ–±–ª–µ–º–∞: SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º:
```bash
sudo ls -la /etc/nginx/ssl/
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx:
```bash
sudo nginx -t
```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:
```bash
sudo certbot certificates
```

## üìù –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### Docker

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose restart webapp

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
git pull
docker-compose build
docker-compose up -d

# –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –æ–±—Ä–∞–∑–æ–≤
docker system prune -a
```

### Nginx

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
sudo systemctl reload nginx

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### –°–∏—Å—Ç–µ–º–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
df -h
du -sh /opt/baichain

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
netstat -tlnp
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ SMTP](WebApplication2/SMTP_CONFIGURATION.md)
- [.NET Documentation](https://docs.microsoft.com/dotnet/)
- [Docker Documentation](https://docs.docker.com/)
- [Nginx Documentation](https://nginx.org/en/docs/)

## üë• –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

1. –°–æ–∑–¥–∞–π—Ç–µ action –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ:
```csharp
public IActionResult NewPage()
{
    return View();
}
```

2. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤ `Views/Home/NewPage.cshtml`

3. –î–æ–±–∞–≤—å—Ç–µ –º–∞—Ä—à—Ä—É—Ç –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—é (`_Layout.cshtml`)

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤ `Services/`
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤ `Program.cs`:
```csharp
builder.Services.AddScoped<IMyService, MyService>();
```

### –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è

- –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏: `wwwroot/css/custom.css`
- –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç–∏–ª–∏: `wwwroot/css/custom-theme.css`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–º–Ω–æ–π/—Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

[–£–∫–∞–∂–∏—Ç–µ –ª–∏—Ü–µ–Ω–∑–∏—é –ø—Ä–æ–µ–∫—Ç–∞]

## ü§ù –ö–æ–Ω—Ç–∞–∫—Ç—ã

- Email: order@baichein.ru
- Website: [your-domain.com]

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2024

